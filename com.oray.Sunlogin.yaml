app-id: com.oray.Sunlogin
runtime: org.freedesktop.Platform
runtime-version: "23.08"
sdk: org.freedesktop.Sdk
command: /usr/bin/bash
finish-args:
  - --share=network
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
  - --device=dri
separate-locales: false

modules:
  - name: libxcrypt
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/besser82/libxcrypt/releases/download/v4.4.36/libxcrypt-4.4.36.tar.xz
        sha256: e5e1f4caee0a01de2aee26e3138807d6d3ca2b8e67287966d1fefd65e1fd8943
  - name: gnome-common
    buildsystem: autotools
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/gnome-common/-/archive/3.18.0/gnome-common-3.18.0.tar.gz
        sha256: 8407fd8786a44c9ce47987de0906d9266492195df9251a089afaa06cc65c72d8
  - "shared-modules/intltool/intltool-0.51.json"
  - "shared-modules/dbus-glib/dbus-glib.json"
  - name: libgconf
    buildsystem: autotools
    config-opts:
      - --disable-orbit
    sources:
      - type: archive
        url: https://gitlab.gnome.org/Archive/gconf/-/archive/3.2.6/gconf-3.2.6.tar.gz
        sha256: d73497412da91896a110853b5fc62f906211d0e0e61a5e535a34e55e0d445e78
  - name: sunlogin
    buildsystem: simple
    build-commands:
      - install -D -m 755 -t /app/bin/ apply_extra
    only-arches:
      - "x86_64"
    sources:
      - type: script
        commands:
          - bsdtar -x -f SunloginClient-amd64.deb
          - tar -xf data.tar.xz
          - mv usr/local/sunlogin .
          # sunlogin hardcode /usr/local/sunlogin for res, replace it.
          - sed -i.bak 's|/usr/local/sunlogin|/app/extra/sunlogin|g' sunlogin/bin/sunloginclient
          - rm -rf usr *.tar.* debian-binary *.deb
        dest-filename: apply_extra
      - type: extra-data
        filename: SunloginClient-amd64.deb
        url: https://d.oray.com/sunlogin/linux/SunloginClient_15.2.0.63062_amd64.deb
        # url: http://127.0.0.1:18088/SunloginClient_15.2.0.63062_amd64.deb
        sha256: 143956eaa79b4ae9939b16ca2691c201f6299b81222081d5d5ce186d593b0c11
        size: 80560728
